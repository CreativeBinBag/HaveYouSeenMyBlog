---
const { src, alt, caption, rotate = "2" } = Astro.props;
const finalSrc = src.startsWith("/")
  ? `${import.meta.env.BASE_URL}${src.substring(1)}`
  : src;

const rotationMap: Record<string, string> = {
  "-2": "-rotate-2",
  "-1": "-rotate-1",
  "0": "rotate-0",
  "1": "rotate-1",
  "2": "rotate-2",
  "3": "rotate-3",
};

const rotationClass = rotationMap[rotate] || "rotate-1";
---

<figure
  class={`relative inline-block my-8 mx-auto w-full max-w-md transform ${rotationClass} transition-transform hover:rotate-0 hover:z-10 hover:scale-[1.02] duration-300`}
>
  <!-- washi -->
  <div
    class="absolute -top-3 left-1/2 -translate-x-1/2 w-16 h-6 bg-p-pink/60 dark:bg-p-mint/60 backdrop-blur-sm z-20 shadow-sm transform -rotate-1 skew-x-12"
  >
  </div>

  <div
    class="bg-white dark:bg-gray-200 p-3 pb-2 shadow-pixel-md border border-gray-200 group"
  >
    <div
      class="aspect-square w-full overflow-hidden bg-gray-100 border border-gray-100 relative"
    >
      <img
        src={finalSrc}
        alt={alt}
        class="w-full h-full object-cover filter contrast-110 hover:contrast-100 transition-all duration-500"
        loading="lazy"
      />
      <div
        class="absolute inset-0 pointer-events-none bg-[url('data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyIiBoZWlnaHQ9IjIiPjxyZWN0IHdpZHRoPSIyIiBoZWlnaHQ9IjEiIGZpbGw9InJnYmEoMCwwLDAsMC4wNSkiLz48L3N2Zz4=')] bg-repeat opacity-20"
      >
      </div>
    </div>

    {
      caption && (
        <figcaption class="mt-3 mb-1 text-center font-pixel text-gray-600 text-lg leading-tight">
          {caption}
        </figcaption>
      )
    }
  </div>
</figure>
